# loss=nan 問題總結與排查大綱

---

## 1. loss=nan 的意義
**小結：loss=nan 代表模型訓練過程中出現數值異常，需立即排查。**
- 代表模型計算過程出現無效數值
- 常見於深度學習訓練流程
- 會導致模型無法正常學習
- 需及時中止訓練並排查
- 是數值穩定性問題的警訊

---

## 2. loss=nan 的常見成因
**小結：多種因素可能導致 loss=nan，需逐一檢查。**
- 學習率過高，導致梯度爆炸
- 標註或資料異常（如 bbox 為負）
- 預處理順序錯誤（如未先 ToTensor）
- 模型初始化或結構錯誤
- 數值運算異常（如 log(0)、除以0）

---

## 3. loss=nan 的流程架構
**小結：loss=nan 可能在訓練流程任一環節產生。**

| 流程步驟         | 可能異常點         |
|------------------|--------------------|
| 資料讀取         | 圖片/標註損壞      |
| 預處理           | 數值範圍錯誤       |
| forward          | 輸出 nan/inf       |
| loss 計算        | 無效數值           |
| backward         | 梯度爆炸/消失      |
| 參數更新         | 權重異常           |

---

## 4. 排查環節與成因
**小結：每個環節都可能是 loss=nan 的根源，需逐步檢查。**
- 資料讀取：檢查圖片、標註完整性
- 預處理：檢查 ToTensor、Normalize 順序
- 增強/標準化：檢查 augmentation 參數
- 模型 forward/loss：檢查輸出與 loss 是否正常
- backward/optimizer：檢查學習率與梯度

---

## 5. 標準排查流程

**小結：逐步檢查訓練流程每一環節的數值與設定，定位 loss=nan 的根本原因。**

1. **資料讀取與預處理**  
   - 檢查圖片、標註是否正確，預處理後的 tensor 是否在合理範圍（如 0~1）。

2. **資料增強與標準化**  
   - 確認 augmentation、normalize 沒有導致數值異常或失真。

3. **模型 forward**  
   - 檢查模型輸出是否有 nan/inf，輸出 shape 是否正確。

4. **loss 計算**  
   - 檢查 loss 是否為正常數值，無 nan/inf。

5. **backward 與參數更新**  
   - 檢查梯度是否爆炸或消失，參數更新後數值是否異常。

6. **學習率與優化器**  
   - 學習率設置是否合理，優化器參數是否正確。

7. **逐步 debug**  
   - 每一步可用 print/tensorboard/斷點，逐步定位異常來源，並調整學習率、預處理、資料等設定。